<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bible Course App - Voice Learning</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ“– Bible Course App</h1>
            <p>Interactive Voice-Guided Bible Study</p>
        </div>

        <div id="debugPanel" class="debug-panel hidden">
            <div class="debug-header">Debug (mobile)</div>
            <pre id="debugLog"></pre>
        </div>

        <div id="splash" class="splash">
            <button id="startBtn" class="btn-primary">Begin Learning</button>
            <button id="resetBtn" class="btn-secondary" style="margin-top: 20px; font-size: 0.9em;">ðŸ”„ Reset Progress</button>
        </div>

        <div id="lesson" class="lesson hidden">
            <div class="lesson-header">
                <h2 id="lessonTitle">Lesson Title</h2>
                <p id="lessonId" class="lesson-id">ID: bf01_lesson_01</p>
            </div>

            <div class="lesson-content">
                <div class="segment-info">
                    <div class="segment-progress">
                        <span id="segmentNum">0</span> of <span id="segmentTotal">7</span>
                    </div>
                    <div class="segment-type" id="segmentType">Ready</div>
                </div>

                <div class="audio-display">
                    <div id="audioScript" class="audio-script">
                        Click the microphone to start speaking, or click "Start Lesson" below.
                    </div>
                </div>

                <div class="controls">
                    <button id="micBtn" class="btn-mic" title="Click and speak your command">
                        ðŸŽ¤ Speak
                    </button>
                    <div id="micStatus" class="mic-status">Ready</div>
                </div>

                <div class="tts-settings">
                    <h3>Audio Settings</h3>
                    <div class="tts-row">
                        <label for="voiceSelect">Voice</label>
                        <select id="voiceSelect" aria-label="Select voice"></select>
                    </div>
                    <div class="tts-row">
                        <label for="rateRange">Speed</label>
                        <input id="rateRange" type="range" min="0.8" max="1.3" step="0.05" value="1.0" />
                        <span id="rateValue">1.0x</span>
                    </div>
                </div>

                <div class="quick-commands">
                    <h3>Tap Commands:</h3>
                    <div class="command-buttons">
                        <button class="btn-chip" data-command="begin the lesson">Begin the lesson</button>
                        <button class="btn-chip" data-command="read the passage">Read the passage</button>
                        <button class="btn-chip" data-command="explain the context">Explain the context</button>
                        <button class="btn-chip" data-command="analyze the structure">Analyze the structure</button>
                        <button class="btn-chip" data-command="summarize the key themes">Summarize the key themes</button>
                        <button class="btn-chip" data-command="ask the review question">Ask the review question</button>
                        <button class="btn-chip" data-command="end the lesson">End the lesson</button>
                    </div>
                    <div class="manual-command">
                        <input id="commandInput" type="text" placeholder="Type a command (optional)" aria-label="Type a command" />
                        <button id="sendBtn" class="btn-secondary">Send</button>
                    </div>
                </div>

                <div class="available-commands">
                    <h3>Available Commands:</h3>
                    <ul>
                        <li>"Begin the lesson"</li>
                        <li>"Read the passage"</li>
                        <li>"Explain the context"</li>
                        <li>"Analyze the structure"</li>
                        <li>"Summarize the key themes"</li>
                        <li>"Ask the review question"</li>
                        <li>"End the lesson"</li>
                    </ul>
                </div>

                <div class="status-info">
                    <div id="status" class="status"></div>
                </div>

                <button id="playBtn" class="btn-secondary">â–¶ Play Audio</button>
                <button id="prevLessonBtn" class="btn-secondary">â¬… Previous Lesson</button>
                <button id="nextLessonBtn" class="btn-secondary" style="display:none;">âž¡ Next Lesson</button>
                <button id="exitBtn" class="btn-danger">Exit Lesson</button>
            </div>
        </div>

        <div id="error" class="error hidden">
            <p id="errorMessage"></p>
            <button onclick="location.reload()" class="btn-primary">Retry</button>
        </div>
    </div>

    <script>
        (function(){
            const logEl = document.getElementById('debugLog');
            const panel = document.getElementById('debugPanel');
            function show(){ if(panel) panel.classList.remove('hidden'); }
            function log(msg){ if(logEl){ show(); logEl.textContent += msg + '\n'; } }
            window.__debugLog = log;
            window.addEventListener('error', (e) => {
                log('error: ' + (e.message || e.error));
            });
            window.addEventListener('unhandledrejection', (e) => {
                log('rejection: ' + (e.reason && e.reason.message ? e.reason.message : String(e.reason)));
            });
            log('boot: inline logger ready');

            const btn = document.getElementById('startBtn');
            if(btn){
                btn.addEventListener('click', () => {
                    log('click: begin learning');
                    if (typeof window.initializeSession === 'function') {
                        log('call: initializeSession');
                        window.initializeSession();
                    } else {
                        log('warn: initializeSession not available');
                    }
                });
            } else {
                log('warn: startBtn not found');
            }

            setTimeout(() => {
                if(!window.__appLoaded){
                    log('warn: app.js did not load');
                }
            }, 2000);
        })();
    </script>
    <script src="app.js?v=5"></script>
</body>
</html>
